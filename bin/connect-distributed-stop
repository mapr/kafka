#!/bin/sh

TARGET=`jps | grep ConnectDistributed | awk '{print $1}'`
pid="/opt/mapr/pid/kafka-connect.pid"

if [ "x$TARGET" = "x" ]; then
  >&2 echo "No running instance found."
  exit 1
fi

kill "$TARGET"
for i in `seq 20`; do
  sleep 0.25
  ps ax | egrep -i "$1" | grep "$TARGET" > /dev/null
  if [ $? -eq 0 ]; then
    rm -rf ${pid}
    exit 0
  fi
done

>&2 echo "Tried to kill $TARGET but never saw it die"
exit 1